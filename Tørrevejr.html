<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Skal vasketøjet ud?</title>
    <style>
      body {
        font-size: 36px;
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
          document.getElementById("errorGPS").innerHTML = "GPS Lokation er ikke tilgængelig via din browser.";
        }
      }

      function showError(error) {
        // ... (samme som tidligere)
      }

      function showPosition(position) {
        // ... (samme som tidligere)

        var timeIntervals = [
          { start: 8, end: 11 },
          { start: 11, end: 14 },
          { start: 14, end: 17 },
          { start: 17, end: 22 }
        ];

        var good_drying_days = {};
        forecast.forEach(function (item) {
          var date = new Date(item.dt_txt);
          var day_name = days[date.getDay()];
          var humidity = item.main.humidity;
          var weather = item.weather[0].main;
          var hour = date.getHours();

          if (weather !== 'Rain' && humidity < 75 && hour >= 8 && hour <= 22) {
            var interval = timeIntervals.find(function (interval) {
              return hour >= interval.start && hour < interval.end;
            });

            if (interval) {
              var key = day_name + ' - ' + interval.start + '-' + interval.end;
              if (!good_drying_days[key]) {
                good_drying_days[key] = [];
              }
              good_drying_days[key].push({ date: date, humidity: humidity });
            }
          }
        });

        if (Object.keys(good_drying_days).length > 0) {
          var result = 'Ja!, Men kun på disse dage og tidspunkter:<br>';
          Object.keys(good_drying_days).forEach(function (key) {
            var humidities = good_drying_days[key];
            var totalHumidity = humidities.reduce(function (acc, h) {
              return acc + h.humidity;
            }, 0);
            var avgHumidity = Math.round(totalHumidity / humidities.length);
            result += key + ':\tGennemsnitlig luftfugtighed: ' + avgHumidity + '%<br>';
          });
          $('#result').html(result);
        } else {
          $('#result').html('Nej, Dårligt tørre vejr i de næste 7 dage.');
        }
      }
      
      // ... (samme som tidligere)
    </script>
  </head>
  <body onload="getLocation();">
    <h1>Skal vasketøjet ud?</h1>
    <h2><p id="result">Afventer GPS Lokation...</p></h2>
    <h1><p id="errorGPS"></p></h1>
    <p id="cityName"></p>
  </body>
</html>
